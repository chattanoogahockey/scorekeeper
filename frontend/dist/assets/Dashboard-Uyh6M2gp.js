import{j as e,G as k}from"./index-CRuzh1EF.js";import{b as c,u as M}from"./react-vendor-6tIi07-H.js";import{a as L}from"./ui-vendor-NIGUFBhG.js";import{A as O}from"./announcer-controls-DvQkt3qw.js";class z{constructor(){this.apiBase=""}async fetchEvents(u){try{return(await L.get(`${this.apiBase}/api/events`,{params:{gameId:u}})).data}catch(s){throw console.error("Error fetching events:",s),new Error("Failed to load events")}}async submitGoal(u){try{return(await L.post(`${this.apiBase}/api/goals`,u)).data}catch(s){throw console.error("Error submitting goal:",s),new Error("Failed to submit goal")}}async submitPenalty(u){try{return(await L.post(`${this.apiBase}/api/penalties`,u)).data}catch(s){throw console.error("Error submitting penalty:",s),new Error("Failed to submit penalty")}}validateGoalForm(u){const s=["period","team","player","time","shotType","goalType"];for(const m of s)if(!u[m])return`Missing required field: ${m}`;return/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(u.time)?null:"Time must be in MM:SS format"}validatePenaltyForm(u){const s=["period","team","penalizedPlayer","penaltyType","length","time"];for(const m of s)if(!u[m])return`Missing required field: ${m}`;return/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(u.time)?null:"Time must be in MM:SS format"}getPlayersForTeam(u,s){const j=s.find(m=>m.teamName===u);return j?j.players:[]}calculateGameProgress(u,s){const[j,m]=s.split(":").map(Number),E=j*60+m,N=1200,r=N-E,h=(u-1)*N+r,C=3*N;return{percentage:Math.round(h/C*100),totalElapsedTime:h,totalSecondsRemaining:E,elapsedInCurrentPeriod:r}}}const A=new z;function B(){const[t,u]=c.useState(!1),s=c.useRef(null),[j,m]=c.useState(0),[E,N]=c.useState(0),[r,h]=c.useState(1),[C,G]=c.useState(!1),[y,p]=c.useState({current:0,duration:0,isPlaying:!1,fileName:""}),[d,b]=c.useState([]),T=c.useRef([]),w=o=>{const l=[...o];for(let n=l.length-1;n>0;n--){const i=Math.floor(Math.random()*(n+1));[l[n],l[i]]=[l[i],l[n]]}return l};c.useEffect(()=>{let o=!1;return(async()=>{try{const i=await(await fetch("/api/sounds/organs")).json();if(!o&&Array.isArray(i.urls)){const v=w(i.urls);b(v);const $=localStorage.getItem("dj_lastOrganStart")||"";let g=[...v];g.length>1&&g[0]===$&&g.push(g.shift()),T.current=g,m(0)}}catch(n){console.warn("Failed to load organ sounds list",n)}})(),()=>{o=!0}},[]);const[P,R]=c.useState([]),f=c.useRef([]);c.useEffect(()=>{let o=!1;return(async()=>{try{const i=await(await fetch("/api/sounds/fanfare")).json();if(!o&&Array.isArray(i.urls)){const v=w(i.urls);R(v);const $=localStorage.getItem("dj_lastFanfareStart")||"";let g=[...v];g.length>1&&g[0]===$&&g.push(g.shift()),f.current=g,N(0)}}catch(n){console.warn("Failed to load fanfare sounds list",n)}})(),()=>{o=!0}},[]);const[I,S]=c.useState(null),F=(o,l="wav")=>{if(t){console.log("Audio already playing, ignoring request");return}s.current&&(s.current.pause(),s.current.currentTime=0);const n=new Audio(`/sounds/${o}.${l}`);s.current=n,S(n),n.volume=r,u(!0),n.addEventListener("loadedmetadata",()=>{p({current:0,duration:n.duration,isPlaying:!0,fileName:o})}),n.addEventListener("timeupdate",()=>{p(v=>({...v,current:n.currentTime}))});const i=()=>{u(!1),s.current=null,S(null),p({current:0,duration:0,isPlaying:!1,fileName:""})};n.addEventListener("ended",i),n.addEventListener("error",i),n.play().catch(v=>{console.error("Error playing audio:",v),i()})},a=()=>{if(t){console.log("Audio already playing, ignoring request");return}if(!d||d.length===0){console.warn("No organ sounds available");return}if(!T.current||T.current.length===0){const i=w(d);T.current=i}const o=T.current.shift();s.current&&(s.current.pause(),s.current.currentTime=0);const l=new Audio(o);s.current=l,S(l),l.volume=r,u(!0),l.addEventListener("loadedmetadata",()=>{p({current:0,duration:l.duration,isPlaying:!0,fileName:"organ"})}),l.addEventListener("timeupdate",()=>{p(i=>({...i,current:l.currentTime}))});const n=()=>{u(!1),s.current=null,S(null),p({current:0,duration:0,isPlaying:!1,fileName:""})};l.addEventListener("ended",n),l.addEventListener("error",n),l.play().catch(i=>{console.error("Error playing organ audio:",i),n()});try{localStorage.setItem("dj_lastOrganStart",o)}catch{}m(i=>(i+1)%Math.max(d.length,1))},x=()=>{if(t){console.log("Audio already playing, ignoring request");return}if(!P||P.length===0){console.warn("No fanfare sounds available");return}if(!f.current||f.current.length===0){const i=w(P);f.current=i}const o=f.current.shift();s.current&&(s.current.pause(),s.current.currentTime=0);const l=new Audio(o);s.current=l,S(l),l.volume=r,u(!0),l.addEventListener("loadedmetadata",()=>{p({current:0,duration:l.duration,isPlaying:!0,fileName:"fanfare"})}),l.addEventListener("timeupdate",()=>{p(i=>({...i,current:l.currentTime}))});const n=()=>{u(!1),s.current=null,S(null),p({current:0,duration:0,isPlaying:!1,fileName:""})};l.addEventListener("ended",n),l.addEventListener("error",n),l.play().catch(i=>{console.error("Error playing fanfare audio:",i),n()});try{localStorage.setItem("dj_lastFanfareStart",o)}catch{}N(i=>(i+1)%Math.max(P.length,1))};return e.jsxs("div",{className:"p-3",children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"DJ"}),e.jsxs("div",{className:"grid grid-cols-2 gap-1 mb-3",children:[e.jsx("button",{onClick:()=>F("goal_horn","mp3"),disabled:t,className:`min-w-20 h-8 px-2 py-1 text-white rounded transition-all duration-200 text-xs ${t?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800"}`,children:"Goal Horn"}),e.jsx("button",{onClick:()=>F("whistle","mp3"),disabled:t,className:`min-w-20 h-8 px-2 py-1 text-white rounded transition-all duration-200 text-xs ${t?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800"}`,children:"Whistle"}),e.jsx("button",{onClick:()=>F("dj_air_horn","mp3"),disabled:t,className:`min-w-20 h-8 px-2 py-1 text-white rounded transition-all duration-200 text-xs ${t?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800"}`,children:"Air Horn"}),e.jsx("button",{onClick:()=>F("hockey-buzzer","mp3"),disabled:t,className:`min-w-20 h-8 px-2 py-1 text-white rounded transition-all duration-200 text-xs ${t?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800"}`,children:"Buzzer"}),e.jsx("button",{onClick:a,disabled:t,className:`min-w-20 h-8 px-2 py-1 text-white rounded transition-all duration-200 text-xs ${t?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800"}`,children:"Organs"}),e.jsx("button",{onClick:x,disabled:t,className:`min-w-20 h-8 px-2 py-1 text-white rounded transition-all duration-200 text-xs ${t?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800"}`,children:"Fanfare"}),e.jsx("div",{})," ",e.jsx("div",{})," "]}),y.isPlaying&&e.jsxs("div",{className:"mt-2 p-2 bg-gray-50 rounded border",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[e.jsx("span",{children:y.fileName}),e.jsxs("span",{children:[Math.round(y.current),"s / ",Math.round(y.duration),"s"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1",children:e.jsx("div",{className:"bg-blue-500 h-1 rounded-full transition-all duration-100",style:{width:`${Math.min(y.current/y.duration*100,100)}%`}})})]}),t&&!y.isPlaying&&e.jsx("p",{className:"text-sm text-gray-500 mt-2 text-center",children:"Audio playing..."})]})}function U(){const{selectedGame:t,rosters:u}=c.useContext(k),s=M();c.useEffect(()=>{t||s("/")},[t,s]);const[j,m]=c.useState([]),[E,N]=c.useState(null);c.useEffect(()=>{if(!t)return;(async()=>{try{const x=await A.fetchEvents(t.id);m(x)}catch(x){console.error("Failed to fetch events",x),N("Error loading events")}})()},[t]);const[r,h]=c.useState({period:"",team:"",player:"",assist1:"",assist2:"",time:"",shotType:"",goalType:""}),[C,G]=c.useState(!1),[y,p]=c.useState(null),[d,b]=c.useState({period:"",team:"",penalizedPlayer:"",penaltyType:"",length:"",time:""}),[T,w]=c.useState(!1),[P,R]=c.useState(null),f=a=>{const x=u.find(o=>o.teamName===a);return x?x.players:[]},I=async()=>{if(t)try{const a=await A.fetchEvents(t.id);m(a)}catch(a){console.error("Failed to refresh events",a)}},S=async a=>{a.preventDefault();const x=["period","team","player","time","shotType","goalType"];for(const o of x)if(!r[o]){p(`Missing required field: ${o}`);return}G(!0),p(null);try{await A.submitGoal({gameId:t.id,period:r.period,team:r.team,player:r.player,assist:[r.assist1,r.assist2].filter(Boolean)[0]||null,time:r.time,shotType:r.shotType,goalType:r.goalType}),h({period:"",team:"",player:"",assist1:"",assist2:"",time:"",shotType:"",goalType:""}),await I()}catch(o){console.error("Failed to submit goal",o),p("Failed to submit goal. Please try again.")}finally{G(!1)}},F=async a=>{a.preventDefault();const x=["period","team","penalizedPlayer","penaltyType","length","time"];for(const o of x)if(!d[o]){R(`Missing required field: ${o}`);return}w(!0),R(null);try{await A.submitPenalty({gameId:t.id,period:d.period,team:d.team,penalizedPlayer:d.penalizedPlayer,penaltyType:d.penaltyType,length:d.length,time:d.time}),b({period:"",team:"",penalizedPlayer:"",penaltyType:"",length:"",time:""}),await I()}catch(o){console.error("Failed to submit penalty",o),R("Failed to submit penalty. Please try again.")}finally{w(!1)}};return t?e.jsxs("div",{className:"p-4 max-w-5xl mx-auto",children:[e.jsxs("h2",{className:"text-3xl font-bold mb-4 text-center",children:["Game Dashboard: ",t.awayTeam," vs ",t.homeTeam]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:[e.jsx("h3",{className:"text-2xl font-bold mb-4",children:"Scorekeeper"}),e.jsxs("div",{className:"grid gap-8 md:grid-cols-2",children:[e.jsxs("div",{className:"border rounded shadow p-4",children:[e.jsx("h4",{className:"text-xl font-semibold mb-2",children:"Record Goal"}),y&&e.jsx("p",{className:"text-red-500 mb-1",children:y}),e.jsxs("form",{onSubmit:S,className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:"Period"}),e.jsxs("select",{value:r.period,onChange:a=>h({...r,period:a.target.value}),className:"border rounded p-1",children:[e.jsx("option",{value:"",children:"Select Period"}),e.jsx("option",{value:"1",children:"1"}),e.jsx("option",{value:"2",children:"2"}),e.jsx("option",{value:"3",children:"3"}),e.jsx("option",{value:"OT",children:"OT"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:"Team"}),e.jsxs("select",{value:r.team,onChange:a=>{h({...r,team:a.target.value,player:"",assist1:"",assist2:""})},className:"border rounded p-1",children:[e.jsx("option",{value:"",children:"Select Team"}),e.jsx("option",{value:t.awayTeam,children:t.awayTeam}),e.jsx("option",{value:t.homeTeam,children:t.homeTeam})]})]}),r.team&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:"Player"}),e.jsxs("select",{value:r.player,onChange:a=>h({...r,player:a.target.value}),className:"border rounded p-1",children:[e.jsx("option",{value:"",children:"Select Player"}),f(r.team).map(a=>e.jsx("option",{value:a.name,children:a.name},a.name))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:"Assist 1 (optional)"}),e.jsxs("select",{value:r.assist1,onChange:a=>h({...r,assist1:a.target.value}),className:"border rounded p-1",children:[e.jsx("option",{value:"",children:"None"}),f(r.team).map(a=>e.jsx("option",{value:a.name,children:a.name},a.name))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:"Assist 2 (optional)"}),e.jsxs("select",{value:r.assist2,onChange:a=>h({...r,assist2:a.target.value}),className:"border rounded p-1",children:[e.jsx("option",{value:"",children:"None"}),f(r.team).map(a=>e.jsx("option",{value:a.name,children:a.name},a.name))]})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:"Time (mm:ss)"}),e.jsx("input",{type:"text",value:r.time,onChange:a=>h({...r,time:a.target.value}),className:"border rounded p-1",placeholder:"00:00"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:"Shot Type"}),e.jsxs("select",{value:r.shotType,onChange:a=>h({...r,shotType:a.target.value}),className:"border rounded p-1",children:[e.jsx("option",{value:"",children:"Select Shot Type"}),e.jsx("option",{value:"Wrist Shot",children:"Wrist Shot"}),e.jsx("option",{value:"Slap Shot",children:"Slap Shot"}),e.jsx("option",{value:"Backhand",children:"Backhand"}),e.jsx("option",{value:"Tip-In",children:"Tip-In"}),e.jsx("option",{value:"Wraparound",children:"Wraparound"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:"Goal Type"}),e.jsxs("select",{value:r.goalType,onChange:a=>h({...r,goalType:a.target.value}),className:"border rounded p-1",children:[e.jsx("option",{value:"",children:"Select Goal Type"}),e.jsx("option",{value:"Regular",children:"Regular"}),e.jsx("option",{value:"Breakaway",children:"Breakaway"}),e.jsx("option",{value:"Power Play",children:"Power Play"}),e.jsx("option",{value:"Short-Handed",children:"Short-Handed"}),e.jsx("option",{value:"Empty Net",children:"Empty Net"}),e.jsx("option",{value:"Penalty Shot",children:"Penalty Shot"})]})]}),e.jsx("button",{type:"submit",disabled:C,className:"px-4 py-2 rounded bg-green-600 text-white hover:bg-green-700",children:C?"Submitting...":"Record Goal"})]})]}),e.jsxs("div",{className:"border rounded shadow p-4",children:[e.jsx("h4",{className:"text-xl font-semibold mb-2",children:"Record Penalty"}),P&&e.jsx("p",{className:"text-red-500 mb-1",children:P}),e.jsxs("form",{onSubmit:F,className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:"Period"}),e.jsxs("select",{value:d.period,onChange:a=>b({...d,period:a.target.value}),className:"border rounded p-1",children:[e.jsx("option",{value:"",children:"Select Period"}),e.jsx("option",{value:"1",children:"1"}),e.jsx("option",{value:"2",children:"2"}),e.jsx("option",{value:"3",children:"3"}),e.jsx("option",{value:"OT",children:"OT"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:"Team"}),e.jsxs("select",{value:d.team,onChange:a=>b({...d,team:a.target.value,penalizedPlayer:""}),className:"border rounded p-1",children:[e.jsx("option",{value:"",children:"Select Team"}),e.jsx("option",{value:t.awayTeam,children:t.awayTeam}),e.jsx("option",{value:t.homeTeam,children:t.homeTeam})]})]}),d.team&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:"Player"}),e.jsxs("select",{value:d.penalizedPlayer,onChange:a=>b({...d,penalizedPlayer:a.target.value}),className:"border rounded p-1",children:[e.jsx("option",{value:"",children:"Select Player"}),f(d.team).map(a=>e.jsx("option",{value:a.name,children:a.name},a.name))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:"Penalty Type"}),e.jsxs("select",{value:d.penaltyType,onChange:a=>b({...d,penaltyType:a.target.value}),className:"border rounded p-1",children:[e.jsx("option",{value:"",children:"Select Type"}),e.jsx("option",{value:"Tripping",children:"Tripping"}),e.jsx("option",{value:"Hooking",children:"Hooking"}),e.jsx("option",{value:"Slashing",children:"Slashing"}),e.jsx("option",{value:"Interference",children:"Interference"}),e.jsx("option",{value:"Holding",children:"Holding"}),e.jsx("option",{value:"High Sticking",children:"High Sticking"}),e.jsx("option",{value:"Roughing",children:"Roughing"}),e.jsx("option",{value:"Delay of Game",children:"Delay of Game"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:"Length (minutes)"}),e.jsxs("select",{value:d.length,onChange:a=>b({...d,length:a.target.value}),className:"border rounded p-1",children:[e.jsx("option",{value:"",children:"Select Length"}),e.jsx("option",{value:"2",children:"2"}),e.jsx("option",{value:"4",children:"4"}),e.jsx("option",{value:"5",children:"5"}),e.jsx("option",{value:"10",children:"10"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:"Time (mm:ss)"}),e.jsx("input",{type:"text",value:d.time,onChange:a=>b({...d,time:a.target.value}),className:"border rounded p-1",placeholder:"00:00"})]}),e.jsx("button",{type:"submit",disabled:T,className:"px-4 py-2 rounded bg-red-600 text-white hover:bg-red-700",children:T?"Submitting...":"Record Penalty"})]})]})]})]}),e.jsxs("div",{className:"grid gap-8 md:grid-cols-2 mt-8",children:[e.jsx(O,{gameId:t.id}),e.jsx(B,{})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-2xl font-semibold mb-2",children:"Live Event Feed"}),E&&e.jsx("p",{className:"text-red-500",children:E}),e.jsx("ul",{className:"space-y-2",children:j.map(a=>e.jsx("li",{className:"border rounded p-2 bg-white shadow",children:a.eventType==="goal"?e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Goal"})," by ",a.playerName||a.scorer," for ",a.teamName||a.scoringTeam]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Assists: ",(a.assistedBy||a.assists||[]).length>0?(a.assistedBy||a.assists).join(", "):"None"," | Shot: ",a.shotType," | Type: ",a.goalType]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Time: ",a.timeRemaining||a.time,", Period: ",a.period]})]}):e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Penalty"})," on ",a.playerName||a.penalizedPlayer," (",a.teamName||a.penalizedTeam||a.team,")"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Type: ",a.penaltyType,", Length: ",a.length||a.penaltyLength," minutes"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Time: ",a.timeRemaining||a.time,", Period: ",a.period]})]})},a.id))})]})]}):null}export{U as default};
