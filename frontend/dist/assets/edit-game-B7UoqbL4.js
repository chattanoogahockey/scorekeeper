import{j as e}from"./index-CRuzh1EF.js";import{e as L,u as F,b as l}from"./react-vendor-6tIi07-H.js";import{a as i}from"./ui-vendor-NIGUFBhG.js";function U(){const{gameId:c}=L(),N=F(),[G,v]=l.useState(null),[g,u]=l.useState([]),[p,b]=l.useState([]),[w,S]=l.useState([]),[E,T]=l.useState(!0),[D,A]=l.useState(!1),[C,y]=l.useState(""),[$,m]=l.useState(""),n="",[r,f]=l.useState({homeTeam:"",awayTeam:"",gameDate:"",homeScore:0,awayScore:0});l.useEffect(()=>{P()},[c]);const P=async()=>{try{T(!0);const s=(await i.get(`${n}/api/games/${c}`)).data;v(s),f({homeTeam:s.hometeam||"",awayTeam:s.awayteam||"",gameDate:s.gameDate?s.gameDate.split("T")[0]:"",homeScore:s.homeScore||0,awayScore:s.awayScore||0});try{const t=await i.get(`${n}/api/goals/game/${c}`);u(t.data||[])}catch{console.log("No goals found for this game"),u([])}try{const t=await i.get(`${n}/api/penalties/game/${c}`);b(t.data||[])}catch{console.log("No penalties found for this game"),b([])}try{const t=await i.get(`${n}/api/rosters`),o=(t.data?.data||t.data||[]).reduce((d,h)=>(d[h.division]||(d[h.division]=new Set),d[h.division].add(h.teamName),d),{}),j=Object.keys(o).map(d=>({division:d,teams:Array.from(o[d]).sort()}));S(j)}catch{console.log("Could not fetch teams for dropdowns"),S([])}}catch(a){console.error("Error fetching game data:",a),m("Failed to load game data")}finally{T(!1)}},x=(a,s)=>{f(t=>({...t,[a]:s}))},I=async()=>{try{A(!0),m("");const a={...r,homeScore:parseInt(r.homeScore)||0,awayScore:parseInt(r.awayScore)||0};(await i.put(`${n}/api/games/${c}`,a)).data.success&&(y("Game details updated successfully!"),v(t=>({...t,...a})))}catch(a){console.error("Error updating game:",a),m("Failed to update game details")}finally{A(!1)}},B=async a=>{if(confirm("Are you sure you want to delete this goal?"))try{await i.delete(`${n}/api/goals/${a}`),u(o=>o.filter(j=>j.id!==a)),y("Goal deleted successfully!");const s=g.filter(o=>o.id!==a),t=s.filter(o=>o.team===r.homeTeam).length,k=s.filter(o=>o.team===r.awayTeam).length;f(o=>({...o,homeScore:t,awayScore:k}))}catch(s){console.error("Error deleting goal:",s),m("Failed to delete goal")}},R=async a=>{if(confirm("Are you sure you want to delete this penalty?"))try{await i.delete(`${n}/api/penalties/${a}`),b(s=>s.filter(t=>t.id!==a)),y("Penalty deleted successfully!")}catch(s){console.error("Error deleting penalty:",s),m("Failed to delete penalty")}};return E?e.jsx("div",{className:"min-h-screen bg-gray-50 p-4 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading game data..."})]})}):G?e.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Edit Game"}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:()=>N("/admin"),className:"bg-gradient-to-r from-blue-700 to-blue-800 hover:from-blue-800 hover:to-blue-900 text-white px-4 py-2 rounded-lg transition-colors",children:"Back to Admin"}),e.jsx("button",{onClick:I,disabled:D,className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors disabled:bg-gray-400",children:D?"Saving...":"Save Changes"})]})]}),C&&e.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:C}),$&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:$})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Game Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Home Team"}),e.jsxs("select",{value:r.homeTeam,onChange:a=>x("homeTeam",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Home Team"}),w.map(a=>e.jsx("optgroup",{label:`${a.division.toUpperCase()} DIVISION`,children:a.teams.map(s=>e.jsx("option",{value:s,children:s},s))},a.division))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Away Team"}),e.jsxs("select",{value:r.awayTeam,onChange:a=>x("awayTeam",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Away Team"}),w.map(a=>e.jsx("optgroup",{label:`${a.division.toUpperCase()} DIVISION`,children:a.teams.map(s=>e.jsx("option",{value:s,children:s},s))},a.division))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Game Date"}),e.jsx("input",{type:"date",value:r.gameDate,onChange:a=>x("gameDate",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Home Score"}),e.jsx("input",{type:"number",min:"0",value:r.homeScore,onChange:a=>x("homeScore",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Away Score"}),e.jsx("input",{type:"number",min:"0",value:r.awayScore,onChange:a=>x("awayScore",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Current Score"}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-4xl font-bold text-gray-800 mb-2",children:[r.homeTeam||"Home"," ",r.homeScore," - ",r.awayScore," ",r.awayTeam||"Away"]}),e.jsx("p",{className:"text-gray-600",children:r.gameDate?new Date(r.gameDate).toLocaleDateString():"No date set"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mt-6",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4",children:["Goals (",g.length,")"]}),g.length===0?e.jsx("p",{className:"text-gray-500",children:"No goals recorded for this game."}):e.jsx("div",{className:"space-y-3",children:g.map((a,s)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-semibold",children:["Goal #",s+1]}),e.jsxs("span",{className:"ml-2 text-gray-600",children:["by ",a.scorer||a.playerName," (",a.scoringTeam||a.teamName,")"]}),(a.assists||a.assistedBy)&&e.jsxs("span",{className:"ml-2 text-gray-500",children:["• Assist: ",Array.isArray(a.assists)?a.assists.join(", "):a.assistedBy]}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:a.recordedAt?new Date(a.recordedAt).toLocaleString():"Time not recorded"})]}),e.jsx("button",{onClick:()=>B(a.id),className:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition-colors",children:"Delete"})]},a.id))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mt-6",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4",children:["Penalties (",p.length,")"]}),p.length===0?e.jsx("p",{className:"text-gray-500",children:"No penalties recorded for this game."}):e.jsx("div",{className:"space-y-3",children:p.map((a,s)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-semibold",children:["Penalty #",s+1]}),e.jsxs("span",{className:"ml-2 text-gray-600",children:[a.penalizedPlayer||a.playerName," (",a.penalizedTeam||a.teamName,")"]}),e.jsxs("span",{className:"ml-2 text-orange-600",children:["• ",a.penaltyType]}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:a.recordedAt?new Date(a.recordedAt).toLocaleString():"Time not recorded"})]}),e.jsx("button",{onClick:()=>R(a.id),className:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition-colors",children:"Delete"})]},a.id))})]})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 p-4 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600 text-xl",children:"Game not found"}),e.jsx("button",{onClick:()=>N("/admin"),className:"mt-4 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg",children:"Back to Admin Panel"})]})})}export{U as default};
