import{G as E,j as o}from"./index-CRuzh1EF.js";import{b as u,u as I}from"./react-vendor-6tIi07-H.js";import{a as C}from"./ui-vendor-NIGUFBhG.js";class R{constructor(){this.apiBase=""}determineGoalContext(n,l,m){const b=m.awayTeam||m.awayteam;m.homeTeam||m.hometeam;const g=n===b,h=l.away+(g?1:0),x=l.home+(g?0:1);if(l.away+l.home===0)return"First goal of game";if(h===x)return"Tying goal";if(l.away===l.home)return"Go-ahead goal";if(Math.abs(h-x)>=3)return"Insurance goal";const c=Math.abs(l.away-l.home),w=Math.abs(h-x);return c>w&&c>=2?"Comeback goal":"Regular goal"}async fetchExistingGoals(n){try{return(await C.get(`${this.apiBase}/api/goals`,{params:{gameId:n}})).data||[]}catch(l){return console.error("Error fetching existing goals:",l),[]}}async submitGoal(n){try{return(await C.post(`${this.apiBase}/api/goals`,n)).data}catch(l){throw console.error("Error submitting goal:",l),new Error("Failed to submit goal")}}calculateCurrentScore(n,l){const m=n.filter(g=>g.scoringTeam===(l.awayTeam||l.awayteam)).length,b=n.filter(g=>g.scoringTeam===(l.homeTeam||l.hometeam)).length;return{away:m,home:b}}validateGoalForm(n){const l=["period","team","player","time","shotType","goalType"];for(const b of l)if(!n[b])return`Missing required field: ${b}`;return/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(n.time)?n.period<1||n.period>3?"Period must be between 1 and 3":null:"Time must be in MM:SS format"}getPlayersForTeam(n,l){const m=l.find(b=>b.teamName===n);return m?m.players:[]}}const f=new R;function A(){const{selectedGame:a,rosters:n}=u.useContext(E),l=I(),[m,b]=u.useState([]),[g,h]=u.useState({away:0,home:0}),[x,j]=u.useState([]),[t,c]=u.useState({team:"",player:"",assist:"",period:"1",time:"",shotType:"Wrist Shot",goalType:"Regular",breakaway:!1});if(!a)return l("/"),null;u.useEffect(()=>{a&&(async()=>{try{const s=await f.fetchExistingGoals(a.id);j(s);const r=f.calculateCurrentScore(s,a);h(r)}catch(s){console.error("Error fetching existing goals:",s),h({away:0,home:0})}})()},[a]);const w=e=>f.determineGoalContext(e,g,a);u.useEffect(()=>{if(a&&!t.team){const e=a.awayTeam||a.awayteam;c(s=>({...s,team:e}))}},[a,t.team]),u.useEffect(()=>{if(console.log("Team changed:",t.team),console.log("Available rosters:",n),t.team&&n){const e=n.find(s=>s.teamName===t.team);console.log("Found team roster:",e),e&&e.players?(b(e.players),console.log("Set available players:",e.players)):(b([]),console.log("No players found for team"))}},[t.team,n]);const S=e=>{console.log("Team button clicked:",e),c(s=>{const r={...s,team:e,player:"",assist:""};return console.log("New form data:",r),r})},$=e=>{console.log("Period button clicked:",e),c(s=>{const r={...s,period:e};return console.log("New form data:",r),r})},k=e=>{console.log("Time button pressed:",e,"Current time:",t.time);const s=t.time||"00:00";let r="";if(s==="00:00"?r="":(r=s.replace(/:/g,""),r!=="0000"&&r!=="000"&&r!=="00"&&r!=="0"?r=r.replace(/^0+/,""):r=""),console.log("Current digits (processed):",r,"Length:",r.length),r.length>=4){console.log("Max digits reached");return}const i=r+e;console.log("New digits string:",i);let d="";if(i.length===1)d=`00:0${i}`;else if(i.length===2)d=`00:${i}`;else if(i.length===3){const p=i.charAt(0),N=i.substring(1);d=`0${p}:${N}`}else if(i.length===4){const p=i.substring(0,2),N=i.substring(2);d=`${p}:${N}`}console.log("Formatted time:",d);const[y,v]=d.split(":").map(Number);if(i.length===4){if(y>17){console.log("Invalid time - minutes exceeds 17");return}if(y===17&&v!==0){console.log("Invalid time - beyond 17:00");return}if(y===0&&v===0){console.log("Invalid time - below 00:01");return}if(v>59){console.log("Invalid time - seconds exceed 59");return}}console.log("Setting time to:",d),c(p=>({...p,time:d}))},G=()=>{console.log("Clearing time"),c(e=>({...e,time:"00:00"}))},P=()=>{console.log("Backspace time, current:",t.time);const e=t.time||"00:00";if(e==="00:00")return;let s=e.replace(/:/g,"").replace(/^0+/,"")||"";if(s.length<=1){c(d=>({...d,time:"00:00"}));return}const r=s.slice(0,-1);console.log("New digits after backspace:",r);let i="";if(r.length===1)i=`00:0${r}`;else if(r.length===2)i=`00:${r}`;else if(r.length===3){const d=r.charAt(0),y=r.substring(1);i=`0${d}:${y}`}console.log("Formatted time after backspace:",i),c(d=>({...d,time:i}))},T=t.team&&t.player&&t.period&&t.time&&t.time!=="00:00"&&t.time!=="";return o.jsx("div",{className:"min-h-screen bg-blue-50 p-4",children:o.jsxs("div",{className:"max-w-md mx-auto",children:[o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("h1",{className:"text-3xl font-bold text-blue-900 mb-2",children:"Record Goal"}),o.jsxs("p",{className:"text-blue-700",children:[a.homeTeam||a.hometeam," vs ",a.awayTeam||a.awayteam]})]}),o.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg space-y-4",children:[o.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[o.jsxs("div",{className:"col-span-3",children:[o.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Select Team"}),o.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[o.jsx("button",{type:"button",onClick:()=>S(a.awayTeam||a.awayteam),className:`py-2 px-2 border-2 rounded-lg font-medium transition-colors ${t.team===(a.awayTeam||a.awayteam)?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 bg-white text-gray-700 hover:border-blue-300"}`,style:{fontSize:"8px"},children:a.awayTeam||a.awayteam}),o.jsx("button",{type:"button",onClick:()=>S(a.homeTeam||a.hometeam),className:`py-2 px-2 border-2 rounded-lg font-medium transition-colors ${t.team===(a.homeTeam||a.hometeam)?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 bg-white text-gray-700 hover:border-blue-300"}`,style:{fontSize:"8px"},children:a.homeTeam||a.hometeam})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Period"}),o.jsx("div",{className:"grid grid-cols-3 gap-1",children:["1","2","3"].map(e=>o.jsx("button",{type:"button",onClick:()=>$(e),className:`py-1 px-1 border-2 rounded-lg font-medium transition-colors text-xs ${t.period===e?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 bg-white text-gray-700 hover:border-blue-300"}`,children:e},e))})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Goal Scorer"}),o.jsxs("select",{value:t.player,onChange:e=>{console.log("Player selected:",e.target.value),c(s=>({...s,player:e.target.value,assist:""}))},disabled:!t.team||m.length===0,className:"w-full py-2 px-2 border border-gray-300 rounded-lg text-xs",required:!0,children:[o.jsx("option",{value:"",children:t.team?m.length===0?"Loading...":"Choose player":"Select team first"}),m.map(e=>o.jsxs("option",{value:e.name,children:[e.number?`#${e.number} `:"",e.name]},e.playerId))]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Assist"}),o.jsxs("select",{value:t.assist,onChange:e=>{console.log("Assist selected:",e.target.value),c(s=>({...s,assist:e.target.value}))},disabled:!t.team||m.length===0,className:"w-full py-2 px-2 border border-gray-300 rounded-lg text-xs",children:[o.jsx("option",{value:"",children:"No assist"}),m.filter(e=>e.name!==t.player).map(e=>o.jsxs("option",{value:e.name,children:[e.number?`#${e.number} `:"",e.name]},e.playerId))]})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Shot Type"}),o.jsx("div",{className:"grid grid-cols-2 gap-2",children:["Wrist Shot","Slap Shot","Snap Shot","Backhand"].map(e=>o.jsx("button",{type:"button",onClick:()=>{console.log("Shot type selected:",e),c(s=>({...s,shotType:e}))},className:`py-2 px-2 border-2 rounded-lg font-medium transition-colors text-xs ${t.shotType===e?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 bg-white text-gray-700 hover:border-blue-300"}`,children:e},e))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Goal Type"}),o.jsx("div",{className:"grid grid-cols-3 gap-1",children:["Regular","Power Play","Short Handed"].map(e=>o.jsx("button",{type:"button",onClick:()=>{console.log("Goal type selected:",e),c(s=>({...s,goalType:e}))},className:`py-1 px-1 border-2 rounded-lg font-medium transition-colors text-xs ${t.goalType===e?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 bg-white text-gray-700 hover:border-blue-300"}`,children:e==="Power Play"?"PP":e==="Short Handed"?"SH":e},e))}),o.jsx("div",{className:"grid grid-cols-2 gap-1 mt-1",children:["Penalty Shot","Empty Net"].map(e=>o.jsx("button",{type:"button",onClick:()=>{console.log("Goal type selected:",e),c(s=>({...s,goalType:e}))},className:`py-1 px-1 border-2 rounded-lg font-medium transition-colors text-xs ${t.goalType===e?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 bg-white text-gray-700 hover:border-blue-300"}`,children:e==="Penalty Shot"?"Pen Shot":"Empty Net"},e))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Breakaway"}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsx("button",{type:"button",onClick:()=>{console.log("Breakaway selected: false"),c(e=>({...e,breakaway:!1}))},className:`py-1 px-2 border-2 rounded-lg font-medium transition-colors text-xs ${t.breakaway?"border-gray-300 bg-white text-gray-700 hover:border-blue-300":"border-blue-500 bg-blue-50 text-blue-700"}`,children:"No"}),o.jsx("button",{type:"button",onClick:()=>{console.log("Breakaway selected: true"),c(e=>({...e,breakaway:!0}))},className:`py-1 px-2 border-2 rounded-lg font-medium transition-colors text-xs ${t.breakaway?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 bg-white text-gray-700 hover:border-blue-300"}`,children:"Yes"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-lg font-bold text-gray-700 mb-2",children:"Time"}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-3xl font-mono font-bold text-blue-600 mb-3 p-3 bg-blue-50 border-2 border-blue-500 rounded-lg",children:t.time||"00:00"}),o.jsx("div",{className:"grid grid-cols-3 gap-2 mb-3",children:["1","2","3","4","5","6","7","8","9"].map(e=>o.jsx("button",{type:"button",onClick:()=>k(e),className:"py-3 px-4 border-2 border-blue-500 bg-blue-50 text-blue-700 rounded-lg font-bold text-lg hover:bg-blue-100 transition-colors",children:e},e))}),o.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[o.jsx("button",{type:"button",onClick:G,className:"py-2 px-3 border-2 border-red-500 bg-red-50 text-red-700 rounded-lg font-medium hover:bg-red-100 transition-colors text-sm",children:"Clear"}),o.jsx("button",{type:"button",onClick:()=>k("0"),className:"py-3 px-4 border-2 border-blue-500 bg-blue-50 text-blue-700 rounded-lg font-bold text-lg hover:bg-blue-100 transition-colors",children:"0"}),o.jsx("button",{type:"button",onClick:P,className:"py-2 px-3 border-2 border-gray-500 bg-gray-50 text-gray-700 rounded-lg font-medium hover:bg-gray-100 transition-colors text-sm",children:"⌫"})]})]})]}),o.jsx("button",{type:"button",disabled:!T,className:`w-full py-3 rounded-lg font-bold text-lg transition-colors ${T?"bg-green-600 text-white hover:bg-green-700":"bg-gray-400 text-gray-700 cursor-not-allowed"}`,onClick:async()=>{if(console.log("🚀 GOAL SUBMIT BUTTON CLICKED"),console.log("🎮 Selected Game:",a),console.log("📝 Form Data:",t),console.log("✅ Form Complete:",T),!a){console.error("❌ No game selected"),alert("Error: No game selected. Please select a game first.");return}if(!a.id){console.error("❌ Game has no ID:",a),alert("Error: Selected game has no ID");return}if(!t.team||!t.player||!t.period||!t.time){console.error("❌ Missing required form data:",t),alert("Error: Please fill in all required fields");return}console.log("📡 Starting goal submission...");try{const e="/api/goals",s=w(t.team),r={gameId:a.id,team:t.team,player:t.player,period:t.period,time:t.time,assist:t.assist||null,shotType:t.shotType,goalType:t.goalType,breakaway:t.breakaway,gameContext:{goalContext:s,scoreBeforeGoal:{away:g.away,home:g.home,awayTeam:a.awayTeam||a.awayteam,homeTeam:a.homeTeam||a.hometeam},scoreAfterGoal:{away:g.away+(t.team===(a.awayTeam||a.awayteam)?1:0),home:g.home+(t.team===(a.homeTeam||a.hometeam)?1:0),awayTeam:a.awayTeam||a.awayteam,homeTeam:a.homeTeam||a.hometeam},totalGoalsInGame:x.length+1,period:t.period,timeInPeriod:t.time}};console.log("📦 Goal Payload:",JSON.stringify(r,null,2)),console.log("🔗 Submitting to service"),await f.submitGoal(r),console.log("✅ SUCCESS! Goal submitted via service");const i=t.assist?` (assist: ${t.assist})`:"",d=`Goal Recorded!

${a.awayTeam||a.awayteam} vs ${a.homeTeam||a.hometeam}
${t.player} scored for ${t.team}${i}
Time: ${t.time} - Period ${t.period}
Shot Type: ${t.shotType}`;alert(d),c({team:a.awayTeam||a.awayteam,player:"",assist:"",period:"1",time:"00:00",shotType:"Wrist Shot",goalType:"Regular",breakaway:!1}),l("/ingame")}catch(e){console.error("❌ Failed to record goal:",e),console.error("Error details:",{message:e.message,response:e.response?.data,status:e.response?.status}),alert(`Error recording goal: ${e.response?.data?.error||e.message}`)}},children:"Record Goal"})]}),o.jsx("button",{onClick:()=>l("/ingame"),className:"w-full mt-3 bg-gradient-to-r from-blue-700 to-blue-800 hover:from-blue-800 hover:to-blue-900 text-white py-2 rounded-lg font-medium transition-colors text-sm",children:"Back to In Game Menu"})]})})}export{A as default};
