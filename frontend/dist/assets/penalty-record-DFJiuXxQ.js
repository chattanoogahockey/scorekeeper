import{G as S,j as t}from"./index-CRuzh1EF.js";import{b as m,u as C}from"./react-vendor-6tIi07-H.js";import{a as P}from"./ui-vendor-NIGUFBhG.js";function I(){const{selectedGame:r,rosters:d}=m.useContext(S),c=C(),[g,y]=m.useState(!1),[u,h]=m.useState([]),[a,n]=m.useState({team:"",player:"",penaltyType:"",penaltyLength:"2",period:"1",time:"00:00",details:""}),x=a.team&&a.player&&a.penaltyType&&a.penaltyLength&&a.period&&a.time&&a.time!=="00:00",v="",f=e=>{const l=a.time||"00:00";let o=l==="00:00"?"":l.replace(/:/g,"").replace(/^0+/,"");if(o.length>=4)return;const s=o+e;let i;s.length===1?i=`00:0${s}`:s.length===2?i=`00:${s}`:s.length===3?i=`0${s.charAt(0)}:${s.slice(1)}`:i=`${s.slice(0,2)}:${s.slice(2)}`;const[b,p]=i.split(":").map(Number);s.length===4&&(b>17||b===17&&p!==0||b===0&&p===0||p>59)||n(k=>({...k,time:i}))},j=()=>n(e=>({...e,time:"00:00"})),N=()=>{const e=a.time||"00:00";if(e==="00:00")return;let l=e.replace(/:/g,"").replace(/^0+/,"");if(l.length<=1){n(s=>({...s,time:"00:00"}));return}l=l.slice(0,-1);let o;l.length===1?o=`00:0${l}`:l.length===2?o=`00:${l}`:o=`0${l.charAt(0)}:${l.slice(1)}`,n(s=>({...s,time:o}))},T=["Tripping","Slashing","High-sticking","Cross-checking","Interference","Roughing","Boarding","Checking from behind","Unsportsmanlike conduct","Delay of game"],w=["2","4","5","10","20"];if(!r)return c("/"),null;m.useEffect(()=>{if(r&&!a.team){const e=r.awayTeam||r.awayteam;n(l=>({...l,team:e}))}},[r,a.team]),m.useEffect(()=>{if(console.log("Team changed:",a.team),console.log("Available rosters:",d),a.team&&d){const e=d.find(l=>l.teamName===a.team);console.log("Found team roster:",e),e&&e.players?(h(e.players),console.log("Set available players:",e.players)):(h([]),console.log("No players found for team"))}},[a.team,d]);const $=async e=>{e.preventDefault(),y(!0);try{const l=`${v}/api/penalties`,o={gameId:r.id||r.gameId,team:a.team,player:a.player,period:a.period,time:a.time,penaltyType:a.penaltyType,penaltyLength:a.penaltyLength,details:{description:a.details}};console.log("ðŸ“¦ Penalty Payload:",JSON.stringify(o,null,2)),console.log("ðŸ”— Submitting to:",l),console.log("ðŸŒ Environment mode:","Production"),console.log("ðŸ”§ VITE_API_BASE_URL:","");const s=await P.post(l,o);console.log("âœ… SUCCESS! Response:",s.data);const i=`Penalty Recorded!

${r.awayTeam||r.awayteam} vs ${r.homeTeam||r.hometeam}
${a.player} (${a.team}) - ${a.penaltyType}
Time: ${a.time} - Period ${a.period}
Length: ${a.penaltyLength} minutes`;alert(i),n({team:r.awayTeam||r.awayteam,player:"",penaltyType:"",penaltyLength:"2",period:"1",time:"00:00",details:""}),setTimeout(()=>{c("/ingame")},1e3)}catch(l){console.error("âŒ ERROR submitting penalty:",l);let o="Unknown error occurred";l.response?.data?.error?(o=l.response.data.error,l.response.data.details&&(o+=`

Details: ${l.response.data.details}`)):l.message&&(o=l.message),console.log("ðŸ”— Failed URL:",apiUrl),console.log("ðŸ“± Status:",l.response?.status),console.log("ðŸ’¬ Backend response:",l.response?.data),alert(`Failed to record penalty:

${o}`)}finally{y(!1)}};return t.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:t.jsxs("div",{className:"max-w-md mx-auto",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 mb-6",children:t.jsx("h1",{className:"text-2xl font-bold text-gray-800 text-center",children:"Record Penalty"})}),t.jsx("form",{onSubmit:$,className:"bg-white rounded-lg shadow-md p-6",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Penalized Team"}),t.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[t.jsx("button",{type:"button",onClick:()=>n(e=>({...e,team:r.awayTeam||r.awayteam,player:""})),className:`py-2 px-2 border-2 rounded-lg font-medium transition-colors ${a.team===(r.awayTeam||r.awayteam)?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 bg-white text-gray-700 hover:border-blue-300"}`,style:{fontSize:"12px"},children:r.awayTeam||r.awayteam}),t.jsx("button",{type:"button",onClick:()=>n(e=>({...e,team:r.homeTeam||r.hometeam,player:""})),className:`py-2 px-2 border-2 rounded-lg font-medium transition-colors ${a.team===(r.homeTeam||r.hometeam)?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 bg-white text-gray-700 hover:border-blue-300"}`,style:{fontSize:"12px"},children:r.homeTeam||r.hometeam})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Period"}),t.jsx("div",{className:"flex space-x-1",children:[1,2,3].map(e=>t.jsx("button",{type:"button",onClick:()=>n(l=>({...l,period:e.toString()})),className:`py-2 px-3 border-2 rounded-lg text-sm font-medium transition-colors ${a.period===e.toString()?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 bg-white text-gray-700 hover:border-blue-300"}`,children:e},e))})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Penalized Player"}),t.jsxs("select",{value:a.player,onChange:e=>n(l=>({...l,player:e.target.value})),disabled:!a.team||u.length===0,className:"w-full p-2 border border-gray-300 rounded-md text-sm",required:!0,children:[t.jsx("option",{value:"",children:a.team?u.length===0?"Loading...":"Choose player":"Select team first"}),u.map(e=>t.jsxs("option",{value:e.name,children:[e.number?`#${e.number} `:"",e.name]},e.playerId))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Penalty Type"}),t.jsxs("select",{value:a.penaltyType,onChange:e=>n(l=>({...l,penaltyType:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-md text-sm",required:!0,children:[t.jsx("option",{value:"",children:"Select penalty type"}),T.map(e=>t.jsx("option",{value:e,children:e},e))]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Penalty Length (minutes)"}),t.jsx("div",{className:"flex space-x-2",children:w.map(e=>t.jsx("button",{type:"button",onClick:()=>n(l=>({...l,penaltyLength:e})),className:`py-2 px-4 border-2 rounded-lg text-sm font-medium transition-colors ${a.penaltyLength===e?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 bg-white text-gray-700 hover:border-blue-300"}`,children:e},e))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time in Period"}),t.jsx("div",{className:"text-center text-3xl font-bold text-blue-600 bg-blue-50 py-4 rounded-lg border-2 border-blue-200 mb-4",children:a.time}),t.jsxs("div",{className:"grid grid-cols-3 gap-1 text-center",children:[[1,2,3,4,5,6,7,8,9].map(e=>t.jsx("button",{type:"button",onClick:()=>f(e.toString()),className:"py-2 bg-gray-100 rounded-lg text-sm font-semibold hover:bg-blue-200 transition-colors",children:e},e)),t.jsx("button",{type:"button",onClick:()=>j(),className:"py-2 px-3 border-2 border-red-500 bg-red-50 text-red-700 rounded-lg font-medium hover:bg-red-100 transition-colors text-sm",children:"Clear"}),t.jsx("button",{type:"button",onClick:()=>f("0"),className:"py-2 bg-gray-100 rounded-lg font-semibold hover:bg-blue-200 transition-colors text-sm",children:"0"}),t.jsx("button",{type:"button",onClick:()=>N(),className:"py-2 px-3 border-2 border-gray-500 bg-gray-50 text-gray-700 rounded-lg font-medium hover:bg-gray-100 transition-colors text-sm",children:"âŒ«"})]})]}),t.jsx("button",{type:"submit",disabled:!x||g,className:`w-full font-bold py-4 px-6 rounded-lg text-xl transition-colors ${!x||g?"bg-gray-400 text-gray-700 cursor-not-allowed":"bg-green-600 hover:bg-green-700 text-white"}`,children:g?"Recording...":"Record Penalty"})]})}),t.jsx("button",{onClick:()=>c("/ingame"),className:"w-full mt-3 bg-gradient-to-r from-blue-700 to-blue-800 hover:from-blue-800 hover:to-blue-900 text-white py-2 rounded-lg font-medium transition-colors text-sm",children:"Back to In Game Menu"})]})})}export{I as default};
