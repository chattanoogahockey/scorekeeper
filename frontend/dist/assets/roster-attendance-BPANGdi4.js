import{G as w,j as e}from"./index-CRuzh1EF.js";import{b as m,u as A}from"./react-vendor-6tIi07-H.js";import{a as $}from"./ui-vendor-NIGUFBhG.js";function D(){const{selectedGame:a,rosters:n,setAttendance:f}=m.useContext(w),i=A(),[g,h]=m.useState(null),[u,p]=m.useState(!1),[o,N]=m.useState(!1),j="";if(!a)return i("/"),null;if(!n||n.length===0)return e.jsxs("div",{className:"min-h-screen p-4 flex flex-col items-center justify-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Loading Rosters..."}),e.jsxs("p",{className:"text-gray-600 text-center mb-4",children:["Loading player rosters for ",a.awayTeam," vs ",a.homeTeam]}),e.jsxs("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded mb-4 max-w-md",children:[e.jsx("strong",{children:"Note:"})," If rosters don't load, please go back and ensure both teams have uploaded their rosters to the system."]}),e.jsx("div",{className:"text-center",children:e.jsx("button",{onClick:()=>i("/"),className:"px-4 py-2 bg-gradient-to-r from-blue-700 to-blue-800 hover:from-blue-800 hover:to-blue-900 text-white rounded transition-colors",children:"Back to Game Selection"})})]});const y=async d=>{d.preventDefault(),p(!0),h(null);try{console.log("ðŸ” Starting attendance submission...");const t={};for(const l of n){const c=l.teamName,v=document.querySelectorAll(`input[name="attendance-${c}"]:checked`),b=Array.from(v).map(S=>S.value);t[c]=b,console.log(`ðŸ“‹ ${c}: ${b.length} players present:`,b)}const s={gameId:a.id,attendance:t,totalRoster:n.map(l=>({teamName:l.teamName,teamId:l.teamId,totalPlayers:l.players.map(c=>c.name)}))};console.log("ðŸ“¤ Submitting attendance data:",s),console.log("ðŸŽ¯ Selected game object:",a);const r=`${j}/api/attendance`;console.log("ðŸ”— Submitting to:",r),console.log("ðŸŒ Environment mode:","Production");const x=await $.post(r,s);console.log("âœ… Attendance submission successful:",x.data),f(t),N(!0),setTimeout(()=>{i("/ingame",{replace:!0})},600)}catch(t){console.error("âŒ Failed to submit attendance:",t),console.error("Error details:",{message:t.message,response:t.response?.data,status:t.response?.status}),h(`Failed to submit attendance. Please try again. Error: ${t.response?.data?.error||t.message}`)}finally{p(!1)}};return e.jsxs("div",{className:"min-h-screen p-4",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Who is here for today's game?"}),g&&e.jsx("p",{className:"text-red-500 mb-2",children:g}),e.jsxs("form",{onSubmit:y,className:"space-y-8 max-w-3xl mx-auto",children:[n.map(d=>{const t=d.teamName;return e.jsxs("div",{className:"border rounded shadow p-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:t}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:d.players.map(s=>{const r=s.position==="Sub"||s.name==="Sub",x=o;return e.jsxs("label",{className:"flex items-center space-x-2 p-2 rounded hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",name:`attendance-${t}`,value:s.name,defaultChecked:!r,disabled:x,className:"h-4 w-4"}),e.jsxs("span",{children:[r?"Sub":s.name,s.jerseyNumber?` (#${s.jerseyNumber})`:""]})]},s.name)})})]},t)}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"submit",disabled:o||u,className:`px-8 py-3 rounded text-white text-lg ${o?"bg-green-600 cursor-not-allowed":u?"bg-gray-500 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:o?"âœ“ Attendance Recorded":u?"Recording Attendance...":"Record Attendance"})})]}),o&&e.jsx("div",{className:"mt-4 text-center",children:e.jsx("p",{className:"text-green-600 font-semibold",children:"Attendance recorded! Loading game menu..."})})]})}export{D as default};
